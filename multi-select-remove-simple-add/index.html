<!DOCTYPE html>
<html lang="en">
  <head>
    <title>DataTables Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../lib/bootstrap/css/bootstrap.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="../lib/datatables/css/dataTables.bootstrap4.css"
    />
    <link
      rel="stylesheet"
      href="../lib/datatables-responsive-bs/responsive.bootstrap4.css"
    />
    <link
      rel="stylesheet"
      href="../lib/datatables-select-bs/select.bootstrap4.css"
    />
    <style>
      body {
        background-color: lightgray;
      }
    </style>
    <script src="../lib/jquery/jquery.js"></script>
    <script src="../lib/popper/umd/popper.js"></script>
    <script src="../lib/bootstrap/js/bootstrap.js"></script>
    <script src="../lib/datatables/js/jquery.dataTables.js"></script>
    <script src="../lib/datatables/js/dataTables.bootstrap4.js"></script>
    <script src="../lib/datatables-responsive/dataTables.responsive.js"></script>
    <script src="../lib/datatables-responsive-bs/responsive.bootstrap4.js"></script>
    <script src="../lib/datatables-buttons/js/dataTables.buttons.js"></script>
    <script src="../lib/datatables-select/dataTables.select.js"></script>
    <script src="../scripts/site-scripts.js"></script>
  </head>
  <body>
    <div class="container-fluid mx-2">
      <h1>Multiple Selection Remove Rows and Simple Add Row</h1>
      <h2>Academic Year List</h2>
      <div class="row m-auto">
        <div id="divYearList" class="col-md-12 collapse">
          <table
            id="yearList"
            class="table table-striped table-bordered nowrap table-light"
          ></table>
        </div>
        <div id="divNoYearList" class="alert alert-warning col-md-12 collapse">
          <strong> No Records Found </strong>
        </div>
      </div>
      <div class="row mx-auto">
        <div class="col result"></div>
      </div>
    </div>
    <script>
      $(function () {
        GetYearDataTable();
      });

      function GetYearDataTable() {
        if ($.fn.dataTable.isDataTable("#yearList")) {
          // the DataTable exists already, so just reload the data

          $("#yearList").DataTable().ajax.reload();
        } else {
          var dt = $("#yearList").DataTable({
            responsive: {
              details: {
                renderer: renderDefaultTable, // call custom render function
              },
            },
            autoWidth: false,
            select: 'multi',
            ajax: {
              url: "../data.json",
              dataSrc: "", // empty string tells DataTables to expect an unnamed array
              complete: function (xhr, status) {
                if (status === "success") {
                  if (xhr.responseJSON.length) {
                    $("#divYearList").showDataTable();
                    $("#divNoYearList").hide();
                  } else {
                    $("#divYearList").hide();
                    $("#divNoYearList").show();
                  }
                }
                dt.buttons()
                  .container()
                  .addClass("mb-1")
                  .removeClass("btn-group")
                  .appendTo($("#divYearList"));
              },
            },
            columns: [
              {
                data: "AcademicYearId",
                visible: false,
                name: 'academic-year-id'
              },
              {
                title: "Academic Year",
                data: "AcademicYear",
                responsivePriority: 1,
              },
              {
                title: "Start Date",
                data: "StartDate",
              },
              {
                title: "End Date",
                data: "EndDate",
              },
              {
                title: "Year Link",
                data: "YearUrl",
                render: function (data, type, row) {
                  return `<a href="${data}${row.AcademicYearId}">${row.AcademicYear}</a>`;
                },
              }
            ],
            buttons: [
              {
                text: '<i class="bi bi-person-plus-fill"></i> Add Years',
                attr: {
                  class: "btn btn-success btn-sm mr-2",
                },
                action: function (e, dt, node, config) {

                  // get the number of rows in the table (dt parameter is a ref the DataTable)

                  var totalRows = dt.data().length;

                  // if there are rows; get the column with {name: 'academic-year-id'}, get it's data object, sort the data, reverse the sort and grab the first element in the array

                  var maxYear =
                    totalRows <= 0
                      ? 2019
                      : dt.column('academic-year-id:name').data().sort().reverse()[0];

                  // create an object that looks like the table data

                  var nextYear = parseInt(maxYear) + 1;

                  var newRow = {
                    AcademicYearId: nextYear,
                    AcademicYear: maxYear + '-' + nextYear,
                    StartDate: '09/01/' + maxYear,
                    EndDate: '08/31/' + nextYear,
                    YearUrl: '../happy-year.html?year=',
                  };

                  // add the row, redraw the table

                  dt.row.add(newRow).draw();
                },
              },
              {
                text:
                  '<i class="bi bi-person-dash-fill"></i> Remove Selected Years',
                attr: {
                  class: "btn btn-danger btn-sm mr-2",
                },
                action: function (e, dt, node, config) {

                  // get the selected rows, remove them, redraw the visible DataTable

                  dt.rows({ selected: true }).remove().draw();
                },
              },
            ],
          });
        }
      }
    </script>
  </body>
</html>
